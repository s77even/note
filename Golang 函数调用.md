Golang 函数调用

虚拟地址空间 栈 堆 数据段 代码段  

函数被计算机翻译成可执行指令放入可执行文件中，执行时加载到内存位于代码段中，

call指令 跳转到指定函数入口执行，ret指令负责在函数结束后跳回到调用处继续执行

函数执行时需要有足够的内存空间存放执行所需要的局部变量和参数等，对应虚拟地址空间的栈。

栈从高地址到低地址，堆从低地址到高地址，分配给函数的栈空间叫做函数栈帧，先入的在高地址(栈底)，后入的在低地址(栈顶)

被调用者通过栈指针sp和偏移量确定每个参数变量和返回值，程序执行时利用特定寄存器存储栈指针sp和栈基bp，也有指令寄存器存放下一条要执行的指令地址，Golang中函数栈帧不是逐步扩张，而是一次性分配。 在分配函数栈空间时，直接一次性分配函数所需的最大栈空间，并将栈指针一次性移动到最大空间处。通过栈指针相对寻址方式来找到对应地址使用栈空间

一次性分配是为了栈访问越界，不同的goroutine的栈空间在编译时确定，头部检测代码决定是否需要栈增长

函数调用过程 call ret 

1 call入栈返回地址  跳转到执行指令的地址

2 执行指令分配自己的栈空间，并保存调用者栈基地址，存入自身栈基地址到bp寄存器，并开始执行盛夏之灵

3 ret指令之前会插入两条指令，恢复调用者栈基，释放自身的栈帧空间

4 ret指令 弹出call入栈的返回地址  跳转到返回地址 继续执行



带参数和返回值函数调用