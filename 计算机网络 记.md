计算机网络 **记**

互联的自治的计算机集合

数据通信  资源共享（软件 数据）分布式处理  提高可靠性  负载均衡

组成部分  硬件软件协议

工作方式 边缘部分 用户直接使用  CS ，P2P

​				核心部分 为边缘部分服务

功能组成   **通信子网**实现数据通信 			**资源子网**实现资源共享数据处理

范围分类：广域网WAN 城域网MAN 局域网LAN 个人区域网PAN	

传输技术：广播式网络  点对点网络（使用分组转发和路由选择）



标准化： OSI 	TCP/IP

RFC 因特网标准形式

性能指标：速率 带宽  吞吐量 延迟  时延带宽积  RTT



分层： SDU+PCI=PDU

7层OSI   4层tcp/ip   5层体系结构

OSI    应用层 表示层 会话层 传输层 网络层 数据链路层 物理层    

<img src="C:\Users\wwwwwwl\AppData\Roaming\Typora\typora-user-images\image-20210310165623447.png" alt="image-20210310165623447" style="zoom:50%;" />



应用层： 面向用户，和用户交互产生网络流量的程序。FTP SMTP HTTP

表示层：处理两个通信系统之间的交换信息的表示方式 （数据格式变化，加密解密，数据压缩和恢复）

会话层：向表示层用户进程提供建立连接并在连接上有序地传输数据，建立同步（建立管理终止回话，校验点恢复）ADSP ASP

传输层：负责两个主机中两个进程的通信，(端口号)端到端的通信。（可靠不可靠传输，差错控制，流量控制，复用分用）TCP UDP

网络层：把分组从源端发送到目的端，传输单位是数据报。（路由选择，流量控制，差错控制，拥塞控制）IP IPX ICMP IGMP ARP RARP 

数据链路层：把网络层传输下来的数据包组成帧，帧是其传输单位。(成帧，差错控制，流量控制，访问控制)SDLC HDLC PPP STP

物理层:在物理媒体上实现比特流的传输，单位是比特。RJ45	 802.3



**TCP/IP模型**  应用层 传输层 网络层 链路层

<img src="C:\Users\wwwwwwl\AppData\Roaming\Typora\typora-user-images\image-20210310172058978.png" alt="image-20210310172058978" style="zoom:50%;" />



5层参考结构 结合了上述两种结构的优点

<img src="C:\Users\wwwwwwl\AppData\Roaming\Typora\typora-user-images\image-20210310173507177.png" alt="image-20210310173507177" style="zoom:50%;" />







**物理层**设备：中继器

中继器：对信号进行再生和还原，对衰减信号进行放大，保持与原数据相同，以增强信号的传输距离

中继器的两端 是网段，适用于完全相同的两类网络的互联，网段还要是同一个协议。 

5-4-3规则

集线器：多口中继器。星型拓扑结构，不具备信号的定向传送能力，是一个共享式设备。



**数据链路层**： 

为网络层提供服务。无确认无连接，有确认无连接，有确认面向连接

链路管理 连接的建立释放和保持

助帧

流量控制 限制发送方的发送速率

差错控制 帧错/位错 

**封装成帧**：在一段数据的前后部分添加首部和尾部，包含许多控制信息，负责帧定界。

帧首部使用一个计数字段来表名帧内的字符数，字符计数法。 一错全错

SOH EOT,当传送的帧是文本文件组成的时候，与开始结束不冲突。字符填充法。错误边界。增加转义 

 5 “1” 1 “0”   在发送端扫描信息字段，进行0的填充，接收端删除。只有首尾是六个1。零比特填充法

**差错控制：**差错：位错 （1 比特0出错） 帧错（丢失重复失序） 

比特错：检错编码（奇偶校验码，循环冗余码CRC）   纠错编码 海明码

**流量控制**	接受能力和发送能力不匹配

停止等待协议	每发送一个帧就停止发送，等待对方的确认，在收到确认后再发送下一个帧 

滑动窗口协议（后退N帧协议 (N ->1)GBN  选择重传协议(N->N)SR）

**GBN** 累计确认 稍待确认 按顺序接受 超时重传N， 窗口大小为序号减1

**SR**	 对数据帧逐一确认  值重传出错帧  缓存已接收帧   窗口大小为序号的一半 



点对点链路  通信范围比较广 两个节点通过一个链路连接 常用于广域网

广播式链路	所有主机共享通信介质 常用局域网 通信范围较小

静态划分信道：频分多路复用 FDM   时分复用 TDM 波分复用WDM 码分复用CDM

动态分配信道：轮询访问 随机访问

随机访问：aloha协议 （纯、 时隙）	

​				   CSMA协议 （监听信道门限电压摆动值  ）1坚持，非坚持，p坚持

​					CSMA/CD协议 	（有线）	碰撞检测，冲突检测，规避算法

​					CSMA/CA协议 	（无线）（信道空闲发出RTS request to send）（接收端响应CTS）

轮询访问：

​				轮询协议：主节点轮流邀请从属节点发送数据，发送数据帧询问（轮询开销，等待延迟，主节点故障，）

​				令牌传递协议：令牌环网无碰撞，每个节点都可以在一定时间获得发送权利，不能无限制持有（令牌开销，等待延迟，单点故障）



**局域网**

  以太网 （IEEE802.3标准）无线局域网（IEEE802.11标准）（wifi） 

IEEE802

802.3 以太网   802.5令牌环网   802.8 光纤  802.11 无线局域网

**MAC子层和LLC子层**

mac 数据帧的封装和解封，帧的寻址和识别，链路的管理，为物理层提供服务

llc	识别网络层协议，封装，为网络层提供服务

**以太网**

局域网最常用的技术，造价低廉，应用广泛 ，能够满足一定速度的要求 10M-10G

以太网的两个标准：DIX V2  , IEEE802.3

提供无连接不可靠的服务 



适配器  计算机与外界有局域网的连接是通过通信适配器

MAC地址：硬件地址，物理地址，地址标识符，唯一 48位二进制，常用六个两位十六进制数表示

以太网MAC帧：6 6 2 源地址目的地址长度或类型  数据 

**IEEE802.11** 无线局域网通用标准 mac帧



广域网

ppp 协议 ，面向字节，全双工链路，简单，封装成帧，透明传输 ，可以采用多种协议

HDLC 面向比特

![image-20210311111649904](C:\Users\wwwwwwl\AppData\Roaming\Typora\typora-user-images\image-20210311111649904.png)



**网桥和交换机**链路层扩展

网桥根据MAC的目的地址对帧进行转发和过滤，过滤通信量，增大吞吐量。不同网段互不干扰，扩大了物理范围，提高了可靠性，

路由器 每个端口就是一个冲突域，可以独占传输媒体带宽



## 网络层

把分组从源端传送到目睹段，为分组交换网上不同主机提供通信服务，通信的单位是数据报，分组是切分后的数据报

功能：路由选择和分组转发 选择最佳路径，异构网络互联，拥塞控制，

**数据交换方式** 路由器的互联 交换网络

**电路交换：**建立电路链接，通信， 释放连接。 

优点：时延小，有序，没有冲突，实时性强。

缺：建立连接时间长，线路独占，效率低，灵活差

**报文交换：**传输原应用发送的信息整体，存储转发

优点：无需建立连接，存储转发，动态分配链路，可靠性高

缺点：存储消耗，报文大小限制

**分组交换**：把大的报文分成小的数据块发送

优点：利用率高，比较报文，数据更小易于存储

缺点：需要传输额外信息，分组序号等，到达目的主机需要重新排序重组



路由算法和路由协议

静态路由算法：管理员手动配置路由信息，**简单可靠，路由更繁琐，不适应大型网络**

动态路由算法：路由器之间彼此交换信息，按路由算法优化出路由表，**路由更新快，适应变化，算法复杂，增加网络负担**

动态路由算法:全局性：链路状态路由算法OSPF，距离向量路由算法RIP，

OSPF:所有路由器掌握完整的网络拓拨和链路费用信息，RIP：路由器只掌握物理相连的邻居及链路费用

自治系统AS：在单一技术管理下的一组路由器，使用一种内部的路由选择协议确认内部路由

​				**内部网关协议IGP(OSPF RIP)		外部网关协议 EGP(BGP)**	

**RIP协议**：分布式的基于距离向量的路由选择协议，简单，**每一个路由器维护从他自己到每一个目的网络的唯一最佳距离记录，**

距离：跳数，经过路由器为一跳。超过16跳的网络认为是不可达的。RIP所以适用于小互联网。

仅和路由器交换自己的路由表，30s交换一次并更新，超过180s没有收到，即认为失联，更新与对方的链接。若干次后收敛

好消息传的快，坏消息传的慢，慢收敛。

**OSPF协议**  开放最短路径优先 dijkstra   链路**变化时**使用洪泛法向**所有路由**发送消息，发送的消息是本路由相连的所有**路由器的状态，**

适用互联网规模很大，收敛速度快

**BGP协议**外部网关协议

发生变化时 ，与其他AS邻站BGP发言人交换网络可达性的信息，

 BGP-4 OPEN报文，UPDATE报文，KEEPALIVE报文，NOTIFICATOIN报文

**三种路由协议**

RIP是分布式的基于距离向量的内部网关路由选择协议，通过UDP报文来交换路由信息

OSPF是一个内部网关协议，要交换的信息量较大，使用IP协议交换

BGP是外部网关协议，在不同自治系统之间交换路由信息，外部网络环境复杂，需要保证消息的可靠传输，采用TCP	



**IP数据报格式**

数据报分片 同一数据包的分片使用同一标识，DF 允许分片 MF 更多分片 ，偏移，在原数据包中的位置  	 

IPV4 唯一的32位4字节标识符，标记路由器主机的接口

IP地址   网络号+主机号    点分十进制

特殊的ip 0.0.0.0 本机  0.0.0.x 本网特定主机 1.1.1.1 广播地址 x.x.0.0 一个网络 x.x.1.1 广播 127.0.0.0 回环地址

分类ABCDE类 0 10 110 1110 1111

NAT 网络地址转换，至少有一个有效的外部全球ip地址  经过NAT转换表 对外网地址和本地地址进行转换，进行信息的分发

子网划分：主机号->子网号+主机号    三级IP地址 内部

子网掩码：网络号全1 主机号全0 

CIDR无分类编址：网络前缀+主机号 + /前缀数量 

CIDR地址块：一系列网路前缀相同的IP地址

地址掩码：拥有前缀数量相同的1 其他位全为0

构成超网：将多个子网构成较大的子网，或叫路由聚合

最长前缀匹配

**ARP协议**

ARP高速缓存：完成主机或路由器IP和MAC的映射关系，通过IP地址得出对应的MAC地址，解决下一跳走哪里的问题

使用过程：检查高速缓存中是否有对应表项，有则直接写入MAC帧，没有则用目的MAC地址为全1的帧封装进行广播ARP请求分组，同一局域网中的主机都能够收到请求，目的主机收到请求后回复ARP响应分组，源主机收到后写入缓存。（10-20min更新）

**DHCP地址**

动态主机配置协议DHCP是应用层协议，使用客户/服务器方式，客户端和服务端通过广播方式进行交互，基于UDP

即插即用联网的机制，主机可以从服务器动态获取IP地址，子网掩码，默认网关，DNS服务器名称与IP地址，允许地址重用，支持移动用户加入网络，支持在用地址续租。

DHCP过程： 主机广播DHCP发现报文，DHCP广播提供多个报文，主机向对应DHCP请求报文，DHCP服务器确认。

**ICMP协议 + IGMP**

支持主机或路由器，差错报告，发送特定ICMP报文，

差错报文5种  终点不可达（无法交付） 源点抑制（拥塞丢失）时间超过（TTL=0） 参数问题（首字段问题）改变路由（重定向）

差错报告报文数据字段：将IP数据包的首部取出加上ICMP首部形成 

PING 测试连个主机的连通性，使用ICMP回送请求和回答报文

TRACEROUTE	跟踪一个分组从原点到终点的路径，使用了时间超过差错报文

**IP数据报三种传输方式**

单播 1-1  广播 1-all  组播 1-m

IGMP协议与组播路由选择协议

 **网际组管理协议IGMP 让路由器知道本局域网中是否有主机参加或者退出某个组播组**

**组播路由协议目的是找出以源主机为根节点的组播转发树(基于链路状态的路由选择，基于距离向量的路由选择，协议无关的组播)**



**移动IP**

本地代理 外部代理 永久地址

**网络层设备**：路由器



**传输层	**

传输层提供进程与进程之间的逻辑通信 网络层提供的是主机与主机之间的通信

复用和分用 

传输层对收到的报文进行差错检错

传输层的两个协议  UDP  TCP

端口：传输层的SAP，表示主机中的应用进程，只有本地意义，在不同主机中没有联系

服务端使用的端口号：熟知端口号 0 -1023   登记端口号  1024-49151

客户端使用的端口号：49161 - 65535

常见程序与端口号：![image-20210314120619298](C:\Users\wwwwwwl\AppData\Roaming\Typora\typora-user-images\image-20210314120619298.png)

在网络中采用发送方和接受方的套接字组合来识别端点，套接字唯一标识了网络中的一个主机和他之上的进程



**UDP协议**

无连接，减少开销和发送数据前的时延

udp尽最大努力交付，不保证可靠交付

udp是面向报文的，适合一次性传输少量数据的网络应用

无拥塞控制，适合实时应用

UDP首部开销小，8B, TCP 20B

<img src="C:\Users\wwwwwwl\AppData\Roaming\Typora\typora-user-images\image-20210314121403872.png" alt="image-20210314121403872" style="zoom: 80%;" />

**TCP协议**

面向连接的传输层协议

TCP连接是点对点的每一条TCP连接只能有两个端点

提供可靠交付的服务，无差错 不丢失 不重复 按序到达

全双工通信  发送缓存接收缓存

TCP面向字节流

TCP报文首部格式：

![image-20210314151141558](C:\Users\wwwwwwl\AppData\Roaming\Typora\typora-user-images\image-20210314151141558.png)

![image-20210314152547193](C:\Users\wwwwwwl\AppData\Roaming\Typora\typora-user-images\image-20210314152547193.png)

三次握手：第一次发送连接请求，SYN=1.seq=x

​					服务器收到后回复SYN=1，ACK=1.ack=x+1,seq=y，

​					客户端收到回复后发送ACK=1,ack=y+1,seq=x+1

SYN 洪泛攻击

利用三次握手的特性，攻击者发送第一次握手的请求数据包，服务器收到后回复响应请求，攻击者不对其进行确认，导致TCP连接处于半连接状态。服务器收不到确认，会超时重传 重复发送ACK给攻击者，浪费了大量服务器资源。攻击者会对服务器发送大量这种TCP请求，导致服务器消耗大量内存和CPU。  解决：设置超时，快释放，SYN cookie



四次挥手

 <img src="C:\Users\wwwwwwl\AppData\Roaming\Typora\typora-user-images\image-20210314154653509.png" alt="image-20210314154653509" style="zoom:80%;" />

四次挥手：wireshark

​				客户端发送连接释放报文段，停止发送数据，FIN=1，seq=u，主动关闭 TCP连接，进入FIN-WAIT-1

​				服务器端回送一个确认报文，客户端进入FIN-WAIT-2,ACK=1，seq=v,ack=u+1

​				服务端发送完数据，发出连接释放报文段，主动关闭TCP连接。FIN=1,ACK=1，seq=w，ack=u+1

​				客户端回送一个确认报文段，等待2msl 连接关闭 ACK=1,seq=u+1，ack=w+1

**TCP可靠传输**

校验 序号 确认 重传

**TCP	流量控制**

滑动窗口机制：TCP报文首部的窗口字段控制窗口大小，接收方根据自己的缓存大小，动态地调整发送发的发送窗口大小，即接收窗口rwnd，发送方的发送窗口大小 取 rwnd和拥塞控制的窗口大小的较小值

TCP会为每一个连接设有一个持续计时器，只要TCP连接的乙方收到对方的零窗口通知，就启动持续计时器。

若持续计时器设置的时间到期，就会发送一个零窗口探测报文段

**TCP拥塞控制**

 

**应用层**

HHTP DNS FTP

网络应用模型

CS模型，P2P模型（peer to peer）

**DNS域名解析系统**

域名-> ip  转换

域名解析过程：迭代查询 递归查询

 **万维网和HTTP**

URL 统一资源定位符  <协议>://<主机>:<端口>/<路径>

HTTP 超文本传输协议

 

![image-20210314171848585](C:\Users\wwwwwwl\AppData\Roaming\Typora\typora-user-images\image-20210314171848585.png)

HTTP 协议是无状态的，  

状态码33

![image-20210314172508581](C:\Users\wwwwwwl\AppData\Roaming\Typora\typora-user-images\image-20210314172508581.png)

200 ok 正常处理并返回   204 not content  没有资源可以返回   206 patial content  范围请求返回

301  move permanently 永久重定向 被请求的URL被分配了新的URL 

302 found 临时性重定向  URL临时变动   

303 see other  明确表示客户应使用GET方式定向新的URL获取资源

304 not modified 客户端发送附带条件，服务器端允许访问资源，但是请求为满足条件的情况下返回改状态码

**400 Bad Request：**表示请求报文中存在语法错误

**401 Unauthorized：**未经许可，需要通过HTTP认证；

**403 Forbidden：**服务器拒绝该次访问（访问权限出现问题）

**404 Not Found：**表示服务器上无法找到请求的资源

**500 Inter Server Error：**表示服务器在执行请求时发生了错误

**503 Server Unavailable：**表示服务器暂时处于超负载或正在进行停机维护，无法处理请求；