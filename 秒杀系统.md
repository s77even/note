### 秒杀系统

#### 需求分析

##### 主要功能点

前台用户登录 产品展示 商品抢购

后台订单管理

##### 需求原型设计

###### 主要设计页面（墨刀原型设计工具）

前台页面 后台页面

##### 系统架构设计

###### 系统需求分析

前端页面需要承载大流量

在大并发状态下解决超卖问题

后端接口需要满足横向扩展

###### 架构设计

<img src="C:\Users\wwwwwwl\AppData\Roaming\Typora\typora-user-images\image-20201028114834913.png" alt="image-20201028114834913" style="zoom: 33%;" />







### RabbitMQ

RabbitMQ是面向消息的中间件，用于组件之间的解耦。主要体现在消息的发送者和消费者之间无强依赖关系

特点：高可用，扩展性，多语言，管理界面

主要应用场景：流量削峰，异步处理，应用解耦

15672

#### 工作模式 5672

1、simple模式 			  直连、默认交换机、一个消费者 （创建队列   发送往队列/接受从队列   处理消息）

2、work模式  				多个消费者 但一个消息只能被一个消费者消费

3、Pub/Sub 模式  		交换机、消息持久化、消息被路由投递给多个消息队列、被多个消费者消费

(创建交换机   发送) （创建交换机 创建队列(队列名为空)  绑定队列到交换机  消费消息）

4、Routing模式 	         一个消息被多个消费者获取 消息的目标队列可以被生产者指定(绑定routingkey)



#### IRIS框架

##### MVC工作流程

<img src="C:\Users\wwwwwwl\AppData\Roaming\Typora\typora-user-images\image-20201030101938228.png" alt="image-20201030101938228" style="zoom:50%;" />



datamodels：声明所用结构体类型及tag标签，包括有商品product，订单order

repositories：实现接口与数据库操作管理（增删改查）商品和订单

services：对repository的一层封装 业务逻辑调用

controllers：调用业务逻辑 并将数据操作结果渲染到页面



#### 前台核心功能开发

用户登录页面开发

前端商品展示功能开发

秒杀数据控制开发



#### 服务端优化

后端优化思路

突破session的限制

分布式接口实现

解决超卖

rabbitMQ实现秒杀队列



##### 后端优化思路

系统特征：高并发 大流量

优化方向： 提高网站性能，保护数据库

具体措施：静态化，分布式，消息队列

<img src="C:\Users\wwwwwwl\AppData\Roaming\Typora\typora-user-images\image-20201111163717237.png" alt="image-20201111163717237" style="zoom:50%;" />

cookie：在客户端保存状态的数据

session：在服务端保存状态和数据



分布式：相对于集中式系统 



##### 分布式验证

一致性hash算法



##### redis

redis在秒杀系统中的瓶颈(单件商品)及如何突破

去redis 





##### 限流

###### 前端页面限流

js限制十秒只能提交一次

js限制未登录用户抢购

###### 服务端限流

增加同用户多次抢购时间限制

设置黑名单

漏桶法限流 令牌限流

秒杀开始前隐藏秒杀接口

服务端限制开始时间



##### 秒杀重点汇总

